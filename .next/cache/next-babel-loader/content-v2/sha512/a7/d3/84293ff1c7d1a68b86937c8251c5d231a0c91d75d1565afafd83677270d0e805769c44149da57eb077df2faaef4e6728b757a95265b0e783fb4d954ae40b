{"ast":null,"code":"import jwt from 'jsonwebtoken';\nimport Users from \"./db/models/Users\";\nexport const userMiddleware = async (req, res) => {\n  const token = req.cookies['client-auth-token'];\n\n  if (token) {\n    try {\n      // verify user token and retrieve stored user information\n      const {\n        user\n      } = jwt.verify(token, Users.getSecret()); // save user in request\n\n      req.user = user;\n      req.user.loginToken = token;\n    } catch (e) {\n      console.log(e.message);\n    }\n  }\n};","map":{"version":3,"sources":["/home/erxes/work/erxes-client-portal/client/pages/api/auth.ts"],"names":["jwt","Users","userMiddleware","req","res","token","cookies","user","verify","getSecret","loginToken","e","console","log","message"],"mappings":"AAAA,OAAOA,GAAP,MAAgB,cAAhB;AACA,OAAOC,KAAP;AAEA,OAAO,MAAMC,cAAc,GAAG,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AAChD,QAAMC,KAAK,GAAGF,GAAG,CAACG,OAAJ,CAAY,mBAAZ,CAAd;;AAEA,MAAID,KAAJ,EAAW;AACT,QAAI;AACF;AACA,YAAM;AAAEE,QAAAA;AAAF,UAAWP,GAAG,CAACQ,MAAJ,CAAWH,KAAX,EAAkBJ,KAAK,CAACQ,SAAN,EAAlB,CAAjB,CAFE,CAIF;;AACAN,MAAAA,GAAG,CAACI,IAAJ,GAAWA,IAAX;AACAJ,MAAAA,GAAG,CAACI,IAAJ,CAASG,UAAT,GAAsBL,KAAtB;AACD,KAPD,CAOE,OAAOM,CAAP,EAAU;AACVC,MAAAA,OAAO,CAACC,GAAR,CAAYF,CAAC,CAACG,OAAd;AACD;AACF;AACF,CAfM","sourcesContent":["import jwt from 'jsonwebtoken';\nimport Users from './db/models/Users';\n\nexport const userMiddleware = async (req, res) => {\n  const token = req.cookies['client-auth-token'];\n\n  if (token) {\n    try {\n      // verify user token and retrieve stored user information\n      const { user } = jwt.verify(token, Users.getSecret());\n\n      // save user in request\n      req.user = user;\n      req.user.loginToken = token;\n    } catch (e) {\n      console.log(e.message);\n    }\n  }\n};\n"]},"metadata":{},"sourceType":"module"}