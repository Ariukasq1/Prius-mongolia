{"ast":null,"code":"import jwt from 'jsonwebtoken';\nimport Users from \"./db/models/Users\";\nexport const userMiddleware = async (req, res) => {\n  const token = req.cookies['client-auth-token'];\n\n  if (token) {\n    console.log(token);\n\n    try {\n      // verify user token and retrieve stored user information\n      const {\n        user\n      } = jwt.verify(token, Users.getSecret()); // save user in request\n\n      req.user = user;\n      req.user.loginToken = token;\n    } catch (e) {\n      console.log(e.message);\n    }\n  }\n};","map":{"version":3,"sources":["/home/erxes/work/erxes-client-portal/client/pages/api/auth.ts"],"names":["jwt","Users","userMiddleware","req","res","token","cookies","console","log","user","verify","getSecret","loginToken","e","message"],"mappings":"AAAA,OAAOA,GAAP,MAAgB,cAAhB;AACA,OAAOC,KAAP;AAEA,OAAO,MAAMC,cAAc,GAAG,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AAChD,QAAMC,KAAK,GAAGF,GAAG,CAACG,OAAJ,CAAY,mBAAZ,CAAd;;AAEA,MAAID,KAAJ,EAAW;AACTE,IAAAA,OAAO,CAACC,GAAR,CAAYH,KAAZ;;AACA,QAAI;AACF;AACA,YAAM;AAAEI,QAAAA;AAAF,UAAWT,GAAG,CAACU,MAAJ,CAAWL,KAAX,EAAkBJ,KAAK,CAACU,SAAN,EAAlB,CAAjB,CAFE,CAIF;;AACAR,MAAAA,GAAG,CAACM,IAAJ,GAAWA,IAAX;AACAN,MAAAA,GAAG,CAACM,IAAJ,CAASG,UAAT,GAAsBP,KAAtB;AACD,KAPD,CAOE,OAAOQ,CAAP,EAAU;AACVN,MAAAA,OAAO,CAACC,GAAR,CAAYK,CAAC,CAACC,OAAd;AACD;AACF;AACF,CAhBM","sourcesContent":["import jwt from 'jsonwebtoken';\nimport Users from './db/models/Users';\n\nexport const userMiddleware = async (req, res) => {\n  const token = req.cookies['client-auth-token'];\n\n  if (token) {\n    console.log(token);\n    try {\n      // verify user token and retrieve stored user information\n      const { user } = jwt.verify(token, Users.getSecret());\n\n      // save user in request\n      req.user = user;\n      req.user.loginToken = token;\n    } catch (e) {\n      console.log(e.message);\n    }\n  }\n};\n"]},"metadata":{},"sourceType":"module"}