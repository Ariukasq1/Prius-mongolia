{"ast":null,"code":"import jwt from 'jsonwebtoken';\nimport Users from \"./db/models/Users\";\nexport const userMiddleware = async (req, res, next) => {\n  const token = req.cookies['auth-token'];\n\n  if (token) {\n    try {\n      // verify user token and retrieve stored user information\n      const {\n        user\n      } = jwt.verify(token, Users.getSecret()); // save user in request\n\n      req.user = user;\n      req.user.loginToken = token;\n    } catch (e) {\n      return next();\n    }\n  }\n\n  next();\n};","map":{"version":3,"sources":["/home/erxes/work/erxes-client-portal/client/pages/api/auth.ts"],"names":["jwt","Users","userMiddleware","req","res","next","token","cookies","user","verify","getSecret","loginToken","e"],"mappings":"AAAA,OAAOA,GAAP,MAAgB,cAAhB;AACA,OAAOC,KAAP;AAEA,OAAO,MAAMC,cAAc,GAAG,OAAOC,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB,KAA0B;AACtD,QAAMC,KAAK,GAAGH,GAAG,CAACI,OAAJ,CAAY,YAAZ,CAAd;;AAEA,MAAID,KAAJ,EAAW;AACT,QAAI;AACF;AACA,YAAM;AAAEE,QAAAA;AAAF,UAAWR,GAAG,CAACS,MAAJ,CAAWH,KAAX,EAAkBL,KAAK,CAACS,SAAN,EAAlB,CAAjB,CAFE,CAIF;;AACAP,MAAAA,GAAG,CAACK,IAAJ,GAAWA,IAAX;AACAL,MAAAA,GAAG,CAACK,IAAJ,CAASG,UAAT,GAAsBL,KAAtB;AACD,KAPD,CAOE,OAAOM,CAAP,EAAU;AACV,aAAOP,IAAI,EAAX;AACD;AACF;;AAEDA,EAAAA,IAAI;AACL,CAjBM","sourcesContent":["import jwt from 'jsonwebtoken';\nimport Users from './db/models/Users';\n\nexport const userMiddleware = async (req, res, next) => {\n  const token = req.cookies['auth-token'];\n\n  if (token) {\n    try {\n      // verify user token and retrieve stored user information\n      const { user } = jwt.verify(token, Users.getSecret());\n\n      // save user in request\n      req.user = user;\n      req.user.loginToken = token;\n    } catch (e) {\n      return next();\n    }\n  }\n\n  next();\n};\n"]},"metadata":{},"sourceType":"module"}