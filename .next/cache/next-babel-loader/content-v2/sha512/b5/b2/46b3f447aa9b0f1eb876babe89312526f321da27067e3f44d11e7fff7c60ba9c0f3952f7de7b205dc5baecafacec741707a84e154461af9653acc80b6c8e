{"ast":null,"code":"import Users from \"../../db/models/Users\";\nimport { authCookieOptions } from \"../utils\";\n\nconst login = async (args, res, secure) => {\n  const response = await Users.login(args);\n  const {\n    token\n  } = response;\n  res.cookie('client-auth-token', token, authCookieOptions(secure));\n  return 'loggedIn';\n};\n\nconst userMutations = {\n  async userAdd(_root, {\n    email,\n    password,\n    firstName,\n    lastName\n  }) {\n    const doc = {\n      email: (email || '').toLowerCase().trim(),\n      password: (password || '').trim(),\n      firstName,\n      lastName\n    };\n    const user = await Users.createUser(doc);\n    return 'success';\n  },\n\n  /*\n   * Login\n   */\n  async login(_root, args, {\n    res,\n    requestInfo\n  }) {\n    return login(args, res, requestInfo.secure);\n  },\n\n  /*\n   * Logout\n   */\n  async logout(_root, _args, {\n    res\n  }) {\n    res.clearCookie('client-auth-token');\n    return 'loggedout';\n  }\n\n};\nexport default userMutations;","map":{"version":3,"sources":["/home/erxes/work/erxes-client-portal/client/pages/api/resolvers/mutations/users.ts"],"names":["Users","authCookieOptions","login","args","res","secure","response","token","cookie","userMutations","userAdd","_root","email","password","firstName","lastName","doc","toLowerCase","trim","user","createUser","requestInfo","logout","_args","clearCookie"],"mappings":"AAAA,OAAOA,KAAP;AAGA,SAASC,iBAAT;;AASA,MAAMC,KAAK,GAAG,OAAOC,IAAP,EAAqBC,GAArB,EAA4CC,MAA5C,KAAgE;AAC5E,QAAMC,QAAQ,GAAG,MAAMN,KAAK,CAACE,KAAN,CAAYC,IAAZ,CAAvB;AAEA,QAAM;AAAEI,IAAAA;AAAF,MAAYD,QAAlB;AAEAF,EAAAA,GAAG,CAACI,MAAJ,CAAW,mBAAX,EAAgCD,KAAhC,EAAuCN,iBAAiB,CAACI,MAAD,CAAxD;AAEA,SAAO,UAAP;AACD,CARD;;AAUA,MAAMI,aAAa,GAAG;AACpB,QAAMC,OAAN,CACEC,KADF,EAEE;AACEC,IAAAA,KADF;AAEEC,IAAAA,QAFF;AAGEC,IAAAA,SAHF;AAIEC,IAAAA;AAJF,GAFF,EAaE;AACA,UAAMC,GAAU,GAAG;AACjBJ,MAAAA,KAAK,EAAE,CAACA,KAAK,IAAI,EAAV,EAAcK,WAAd,GAA4BC,IAA5B,EADU;AAEjBL,MAAAA,QAAQ,EAAE,CAACA,QAAQ,IAAI,EAAb,EAAiBK,IAAjB,EAFO;AAGjBJ,MAAAA,SAHiB;AAIjBC,MAAAA;AAJiB,KAAnB;AAOA,UAAMI,IAAI,GAAG,MAAMnB,KAAK,CAACoB,UAAN,CAAiBJ,GAAjB,CAAnB;AAEA,WAAO,SAAP;AACD,GAzBmB;;AA2BpB;AACF;AACA;AACE,QAAMd,KAAN,CAAYS,KAAZ,EAAmBR,IAAnB,EAAiC;AAAEC,IAAAA,GAAF;AAAOiB,IAAAA;AAAP,GAAjC,EAAiE;AAC/D,WAAOnB,KAAK,CAACC,IAAD,EAAOC,GAAP,EAAYiB,WAAW,CAAChB,MAAxB,CAAZ;AACD,GAhCmB;;AAkCpB;AACF;AACA;AACE,QAAMiB,MAAN,CAAaX,KAAb,EAAoBY,KAApB,EAA2B;AAAEnB,IAAAA;AAAF,GAA3B,EAA8C;AAC5CA,IAAAA,GAAG,CAACoB,WAAJ,CAAgB,mBAAhB;AAEA,WAAO,WAAP;AACD;;AAzCmB,CAAtB;AA4CA,eAAef,aAAf","sourcesContent":["import Users from '../../db/models/Users';\nimport { IUser } from '../../db/models/definitions';\nimport * as express from 'express';\nimport { authCookieOptions } from '../utils';\nimport { IContext } from '../../types';\n\ninterface ILogin {\n  email: string;\n  password: string;\n  deviceToken?: string;\n}\n\nconst login = async (args: ILogin, res: express.Response, secure: boolean) => {\n  const response = await Users.login(args);\n\n  const { token } = response;\n\n  res.cookie('client-auth-token', token, authCookieOptions(secure));\n\n  return 'loggedIn';\n};\n\nconst userMutations = {\n  async userAdd(\n    _root,\n    {\n      email,\n      password,\n      firstName,\n      lastName\n    }: {\n      email: string;\n      password: string;\n      firstName: string;\n      lastName?: string;\n    }\n  ) {\n    const doc: IUser = {\n      email: (email || '').toLowerCase().trim(),\n      password: (password || '').trim(),\n      firstName,\n      lastName\n    };\n\n    const user = await Users.createUser(doc);\n\n    return 'success';\n  },\n\n  /*\n   * Login\n   */\n  async login(_root, args: ILogin, { res, requestInfo }: IContext) {\n    return login(args, res, requestInfo.secure);\n  },\n\n  /*\n   * Logout\n   */\n  async logout(_root, _args, { res }: IContext) {\n    res.clearCookie('client-auth-token');\n\n    return 'loggedout';\n  }\n};\n\nexport default userMutations;\n"]},"metadata":{},"sourceType":"module"}